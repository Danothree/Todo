<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"  xmlns:th="http://thymeleaf.org">
<head th:replace="/fragments/head.html :: fragment-head">
</head>
<body>
    <div class="container">
        <header th:replace="/fragments/header.html :: fragment-header"></header>

        <div class="main-box">
            <h2>TO DO LIST</h2><br>

<!--            <form th:action="@{/todolist/create}" method="post">-->
            <div class="d-flex">
                <!--엔터키 이벤트는 버튼이 아니라 input 태그에 적용-->
                <input type="text" placeholder="일정을 추가해주세요" class="underline" id="content" name="content" onkeyup="enterkey()">
                <button type="button" class="btn" onclick="addBtn()">add</button>
            </div>
<!--            </form><br>-->

            <table class="table text-center">
                <tr th:each="todo : ${todo}">
                    <td class="d-flex">
                      <!--  <input type="checkbox" th:onclick="'javascript:changeClass('+${todo.id}+')'" >-->
                        <input type="checkbox" th:onclick="checkBtn([[${todo.id}]])">
                        <input type="text" placeholder="일정" class="underline" th:value="${todo.content}" th:id="${todo.id}" disabled>
                     <!--   <input type="text" placeholder="일정" class="underline" th:value="${todo.content}" th:id="'title' + ${todo.id}" disabled>-->
                      <!--  <a th:href="@{/todolist/detail/{id}(id=${todo.id}})"><img th:src="@{/img/update.png}" width="15px" height="15px"></a>-->
                        <!-- id 찾을때 !! -->
                        <a th:onclick="deleteBtn([[${todo.id}]])"><img th:src="@{/img/delete.png}" width="15px" height="15px" ></a>
                    </td>
                </tr>
            </table>
        </div>

        <footer th:replace="/fragments/footer.html :: fragment-footer"></footer>
    </div>

<script type="text/javascript" >

    /* 포커스 기능 */
    $('#content').focus();

    /* 엔터키 작동 기능 */
    function enterkey() {
        if (window.event.keyCode == 13) {
            addBtn();
        }
    }

    /* 체크박스 선택시 취소선 이벤트 */
    function checkBtn(id) {
        //alert('click');
        let check = document.getElementById(id).className;
        //alert(check);
        if (check === 'underline') {
            document.getElementById(id).className = 'selected';
            return;
        } else {
            document.getElementById(id).className = 'underline';
            return;
        }
    }

    /* 추가 기능 */
    // form태그 안에 button이 있으면
    function addBtn() {
        //alert('click');

        // 유효성 체크
        let content = $('#content').val().trim();
        if (content == '') {
            alert('일정을 입력해주세요!!');
            return;
        }

        const url = '/todolist/create';

        $.ajax({
            type : 'post'
            , url : url
            , data : {
                content : content
            }
            , success : function(){
                window.location.reload();
                alert("create success");
            }
            , error : function(){
                alert("create failure");
            }
        });
    }

    /* 삭제 기능 */
    function deleteBtn(id) { // 파라미터로 받아온 id를 넣어준다.
        //alert(id);
        const url = '/todolist/delete/' + id;
        $.ajax ({
           type : 'delete'
           ,url : url
           , data : {
               id : id
            }
            , success : function (e) {
               window.location.reload();
               alert('delete success');
            }
            , error : function (e) {
               alert('delete fail');
            }
        });
    }
</script>
</body>
</html>